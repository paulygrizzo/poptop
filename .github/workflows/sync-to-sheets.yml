name: Sync Meeting Notes to Google Sheets

on:
  push:
    paths:
      - '10-Team-Docs/meeting-notes/*.md'
      - 'dashboard/initial-action-items-data.tsv'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Extract Action Items and Sync
        run: |
          echo "=== Detecting changed meeting notes ==="

          # Find the most recently modified meeting notes file
          NOTES_FILE=$(ls -t 10-Team-Docs/meeting-notes/*-agenda.md 2>/dev/null | head -1)

          if [ -z "$NOTES_FILE" ]; then
            echo "No meeting notes found"
            exit 0
          fi

          echo "Processing: $NOTES_FILE"

          # Extract action items table (between "## Action Items" and next "---")
          # This creates a JSON payload for the Google Apps Script

          echo "Action items would be synced to Google Sheets"
          echo "Webhook URL needed in secrets.SHEETS_WEBHOOK_URL"

      - name: Notify Google Sheets (webhook)
        if: ${{ env.SHEETS_WEBHOOK_URL != '' }}
        env:
          SHEETS_WEBHOOK_URL: ${{ secrets.SHEETS_WEBHOOK_URL }}
        run: |
          curl -X POST "$SHEETS_WEBHOOK_URL" \
            -H "Content-Type: application/json" \
            -d '{"event": "meeting_notes_updated", "repo": "${{ github.repository }}", "commit": "${{ github.sha }}"}'
